<tool id="genomeindex" name="genomeRetrival" workflow_compatible="false" version="17.09">
    <!-- <description>get genome sequences, annotation and file path (built-in or uploaded)</description> -->
    
    <command><![CDATA[
        bash ${__tool_directory__}/scripts/obtainSpecies.sh
            --curpath ${__tool_directory__}
            #if $genometype.datainput == "no":
                --ensembl $genometype.plant
                --verorder $genometype.version
                #if $genometype.rawdata == "yes":
                    --outgenome $outgenome
                    --outgff3 $outgff3
                    --outtranscript $outtranscript 
                    --outtrsnsnoRNA $outtrsnsnoRNA
                #end if
            #else
                --name $genometype.speciename
                --genome $genometype.genome
                --gff $genometype.annotation
                --transcript $genometype.transcripts
                --otherrna $genometype.otherrna
            #end if
            --speciesout $builtinPath
     ]]></command>

    <inputs>
        <conditional name="genometype">
            <param name="datainput" type="boolean"  truevalue="yes" falsevalue="no" checked="true"
                                        label="Upload your own genome data?" help ="User can also select built-in species by clicking the button-No " />
                <when value="yes">
                    <param name="speciename" type="text" value="Arabidopsis_thaliana"  label="Input species name" />
                    <conditional name="selectGeno">
                        <param name="geno" type="select" multiple="false" display="radio" label="Upload genome data or input data url">
                            <option value="upload" selected="true"> upload data</option>
                            <option value="url" > data url</option>
                        </param>
                            <when value="upload"><param name="genome" type="data" format="fasta" label="Input genome data" /></when>
                            <when value="url"><param name="genome" type="text" value="https://"  label="Input genome data url" /></when>
                    </conditional>

                    <conditional name="selectAnno">
                        <param name="anno" type="select" multiple="false" display="radio" label="Upload GFF3 or input data url" >
                            <option value="upload" selected="true"> upload GFF3</option>
                            <option value="url" > data url</option>
                        </param>
                            <when value="upload"><param name="annotation" type="data" format="fasta" label="Input GFF3 data" /></when>
                            <when value="url"><param name="annotation" type="text" value="https://" label="Input GFF3 data url" /></when>
                    </conditional>

                    <conditional name="selectTrans">
                        <param name="trans" type="select" multiple="false" display="radio" label="Upload transcript or input data url" >
                            <option value="upload" selected="true"> upload transcript</option>
                            <option value="url" > data url</option>
                        </param>
                            <when value="upload"><param name="transcripts" type="data" format="fasta" label="Input transcript data" /></when>
                            <when value="url"><param name="transcripts" type="text"  value="https://"  label="Input transcript data url" /></when>
                    </conditional>

                    <param name="otherrna" type="data" format="fasta" label="Input the t/r/sn/snoRNA sequences" />
                </when>

                <when value="no">
                    <param name="plant" type="select" value="Choose" label="Favorite genomes in Ensembl Plants"
                    help="The common plants were listed. The built-in species contain all the required data.">
                        <options from_data_table="ensembl_plant" >
                            <filter type="sort_by" column="1"/>
                            <validator type="no_options" message="No indexes are available for the selected input dataset"/>
                        </options>
                    </param>

                    <param name="version" type="select" value="Choose" label="Version" help="">
                        <options from_data_table="ensembl_plant_version">
                            <validator type="no_options" message="No indexes are available for the selected input dataset"/>
                        </options>
                    </param>

                    <param name="rawdata" type="boolean"  truevalue="yes" falsevalue="no" checked="false"
                                        label="Output the genome sequences, annotation, and t/r/sn/snoRNA sequences?" help ="" />
                </when>
        </conditional>
    </inputs>

    <stdio><exit_code range="1:" level="fatal" description="Error when running obtainSpecies tool"/></stdio>

    <outputs>
        <data format="simple" name="builtinPath" label="The file path of species: ${genometype.speciename.name}">
            <filter> genometype['datainput'] </filter>
        </data>
        <data format="simple" name="builtinPath" label="The file path of species: ${genometype.plant.value}">
            <filter> !genometype['datainput'] </filter>
        </data>        
        <data format="bgzip" name="outgenome" label="The genome of species: ${genometype.plant.value}">
            <filter> genometype['rawdata'] </filter>
        </data>
        <data format="gff3" name="outgff3" label="The gff3 annotation of species: ${genometype.plant.value}">
            <filter> genometype['rawdata'] </filter>
        </data> 
        <data format="fasta" name="outtranscript" label="The transcripts of species: ${genometype.plant.value}">
            <filter> genometype['rawdata'] </filter>
        </data> 
        <data format="fasta" name="outtrsnsnoRNA" label="The t/r/sn/snoRNA sequences of species: ${genometype.plant.value}">
            <filter> genometype['rawdata'] </filter>
        </data>         
    </outputs>

<help><![CDATA[

.. class:: donemark

**What it does**

This tool provides two ways to fetch genome, annotation, cDNA sequences, and t/r/sn/snoRNAs:

1. Uploading your own data. In this way, the file containing the path of species will be returned. 

2. Downloading sequences and annotation automatically from Ensembl Plants database (ftp://ftp.ensemblgenomes.org/pub/plants). In this way, the downloaded file and the path of species will be returned. 

.. class:: infomark

**Note**

* Users can upload the compressed file (.gz format) to save time.

|

    ]]></help>

    <citations>
        <citation type="doi">10.1007/978-1-4939-6658-5_1</citation>
    </citations>

</tool>
